<!DOCTYPE HTML>
<html lang=en>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial scale=1">
    <link rel="stylesheet" href="styles.css">
    <link href='https://fonts.googleapis.com/css?family=Quicksand:400,300,700' rel='stylesheet' type='text/css'>
    <title>Hikes ideas</title>
</head>
<body>
    <header>
        <h1>Hikes ideas for summer 2017</h1>
        <a id="menu" class="header-menu">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M2 6h20v3H2zm0 5h20v3H2zm0 5h20v3H2z"/>
          </svg>
        </a>
    </header>
    <main>
        <nav id="drawer" class="navigation">
            <!-- <li class="navigation-item">List:<button id="hide-list">Hide <strong>x</strong></button></li> -->
            <div id = "difficulty-level">
                <strong>Difficulty</strong>
                <select data-bind="options: levels,
                    optionsCaption: 'Select level...',
                    value: selectedDifficultyLevel"></select>
            </div>

            <ul class="navigation-list" data-bind="foreach: filteredHikeList">
                <li class="navigation-item">
                    <a class="link" href="#" data-bind="text: name"></a>
                </li>
            </ul>
        </nav>
        <div class="container">
            <section id="map"></section>
        </div>
    </main>
    <script src="js/knockout-3.4.2.js"></script>

    <script>
        var map, markers = {};

        function HikeViewModel() {
            var self = this;

            self.levels = ["Easy", "Medium", "Hard", "Extreme"];

            self.hikeList = [
                { name: "Elsay Lake", difficulty: "Extreme", distance: 20, coords: {lat: 49.415956, lng: -122.932207}},
                { name: "Lindsay Lake Loop", difficulty: "Hard", distance: 10, coords: {lat: 49.346459, lng: -122.826283}},
                { name: "Eagle Bluffs", difficulty: "Easy", distance: 5, coords: {lat: 49.387072, lng: -123.211685}},
                { name: "Elk Mountain", difficulty: "Medium", distance: 5, coords: {lat: 49.114344, lng: -121.807145}},
                { name: "Murrin Provincial Park", difficulty: "Easy", coords: {lat: 49.646566, lng: -123.209304}},
                { name: "Mount Cheam Peak", difficulty: "Medium", coords: {lat: 49.186288, lng: -121.682589}},
                { name: "Howe Sound Crest trail", difficulty: "Hard", coords: {lat: 49.456665, lng: -123.188288}}
            ];

            self.selectedDifficultyLevel = ko.observable();

            self.filteredHikeList = ko.computed(function() {
                var setMapOnMarkers = function (map, markersMap) {
                    console.log(markersMap);
                    var ms = Object.values(markersMap);
                    for (var i = 0; i < ms.length; i++) {
                        ms[i].setMap(map);
                    }
                }

                var filtered = [];

                for (var i = 0; i < self.hikeList.length; i++) {
                    var hike = self.hikeList[i];
                    if (self.selectedDifficultyLevel() === undefined || hike.difficulty === self.selectedDifficultyLevel()) {
                        filtered.push(hike);
                    }
                }

                // Hide all markers first.
                setMapOnMarkers(null, markers);

                // Display markers for each hike in 'filtered' array.
                for (var i = 0; i < filtered.length; i++) {
                    var hike = filtered[i];

                    // Show marker if we already created it before.
                    if (markers[hike.name]) {
                        markers[hike.name].setMap(map);

                    // If we didn't create a marker before, create it and show.
                    // And place it into our markers list.
                    } else {
                        markers[hike.name] = new google.maps.Marker({
                          position: filtered[i].coords,
                          map: map
                        });
                    }
                }

                return filtered;
            });
        }

      /*
       * This script was created not by me. I copied it from Udacity quiz.
       */
      var menu = document.querySelector('#menu');
      var main = document.querySelector('main');
      var drawer = document.querySelector('.navigation');

      menu.addEventListener('click', function(e) {
        drawer.classList.toggle('open');
        e.stopPropagation();
      });
      main.addEventListener('click', function() {
        drawer.classList.remove('open');
      });

      function initMap() {
        var northShore = {lat: 49.414670, lng: -123.146046};
        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 12,
          center: northShore
        });

        ko.applyBindings(new HikeViewModel());
      }
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAcn3D0x7Cflmm87XgDM8sAQQ-YMUCLyaU&callback=initMap"></script>
</body>
</html>
